<!doctype html>
<html lang="es">
<head>
  <!-- Google Tag Manager -->
  <script>(function(w,d,s,l,i){w[l]=w[l]||[];w[l].push({'gtm.start':
  new Date().getTime(),event:'gtm.js'});var f=d.getElementsByTagName(s)[0],
  j=d.createElement(s),dl=l!='dataLayer'?'&l='+l:'';j.async=true;j.src=
  'https://www.googletagmanager.com/gtm.js?id='+i+dl;f.parentNode.insertBefore(j,f);
  })(window,document,'script','dataLayer','GTM-K77VFSTL');</script>
  <!-- End Google Tag Manager -->
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>Admin | Página 3D</title>
  <link rel="stylesheet" href="css/style.css?v=20251222" />
  <style>
    .admin-wrap{display:grid;grid-template-columns:220px 1fr;gap:16px}
    .admin-nav a{display:block;padding:10px 12px;border-radius:10px;margin:6px 0;color:var(--text);text-decoration:none;border:1px solid var(--border);transition:all .15s}
    .admin-nav a:hover{border-color:var(--accent);color:var(--accent)}
    .admin-nav a.active{background:var(--card);border-color:var(--accent);color:var(--accent)}
    .toolbar{display:flex;justify-content:space-between;align-items:center;margin:10px 0}
    .table-scroll{width:100%;overflow-x:auto;-webkit-overflow-scrolling:touch}
    .table{width:100%;border-collapse:collapse;border:1px solid var(--border);border-radius:12px;overflow:hidden}
    .table th{background:var(--card);}
    .table th,.table td{border-bottom:1px solid var(--border);padding:8px 10px;text-align:left}
    .pill{display:inline-block;padding:2px 8px;border:1px solid var(--border);border-radius:999px;font-size:12px}
    .btn-small{font-size:12px;padding:4px 8px;border-radius:8px}
    .btn-danger{border-color:var(--danger);color:var(--danger)}
    .btn-secondary{border-color:var(--border);color:var(--text)}
    .row{display:flex;gap:8px;align-items:center}
    .grid2{display:grid;grid-template-columns:1fr 1fr;gap:12px}
    .thumbs{display:flex;flex-wrap:wrap;gap:8px}
    .thumbs img{width:64px;height:64px;object-fit:cover;border-radius:8px;border:1px solid var(--border)}
    dialog{border:none;border-radius:12px;padding:0}
    dialog::backdrop{background:rgba(0,0,0,.35)}
    #frm-product{padding:16px}
    #frm-product label{display:block;margin-bottom:8px}
    #frm-product input,#frm-product textarea,#frm-product select{width:100%}
    .hidden{display:none}
    /* Scroll horizontal en móvil en lugar de apilar */
    @media (max-width: 720px){
      .table{min-width:760px}
    }
  </style>
  <script>window.ADMIN=true;</script>
</head>
<body>
  <!-- Google Tag Manager (noscript) -->
  <noscript><iframe src="https://www.googletagmanager.com/ns.html?id=GTM-K77VFSTL"
  height="0" width="0" style="display:none;visibility:hidden"></iframe></noscript>
  <!-- End Google Tag Manager (noscript) -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="logo" href="index.html">Página3D</a>
      <button class="nav-toggle" aria-controls="main-nav" aria-expanded="false" aria-label="Menú">☰</button>
      <nav id="main-nav" class="main-nav" aria-label="Principal">
        <a href="index.html">Inicio</a>
        <a href="productos.html">Productos</a>
        <a href="contacto.html">Contacto</a>
      </nav>
    </div>
  </header>

  <main class="container section">
    <h1 class="section-title">Panel de Administración</h1>
    <div class="toolbar">
      <a class="btn" href="account.html">← Regresar a Mi cuenta</a>
      <span></span>
    </div>
    <div id="admin-note" class="account-note"></div>
    <div class="admin-wrap">
      <aside class="admin-nav">
        <a href="#dash" data-view="dash" class="active">Dashboard</a>
        <a href="#products" data-view="products">Productos</a>
        <a href="#orders" data-view="orders">Pedidos</a>
        <a href="#users" data-view="users">Usuarios</a>
      </aside>
      <section>
        <div id="view-dash">
          <div class="grid2">
            <div class="card" style="padding:12px"><div class="row"><strong>Productos:</strong><span id="st-products">0</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Pedidos:</strong><span id="st-orders">0</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Usuarios:</strong><span id="st-users">0</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Ventas (USD):</strong><span id="st-sales">$0.00</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Items vendidos:</strong><span id="st-items">0</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Subtotal sin desc.:</strong><span id="st-suboriginal">$0.00</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Ahorro por desc.:</strong><span id="st-discount">$0.00</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Promedio por pedido:</strong><span id="st-aov">$0.00</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Ventas 7d:</strong><span id="st-sales7">$0.00</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Pedidos 7d:</strong><span id="st-orders7">0</span></div></div>
            <div class="card" style="padding:12px"><div class="row"><strong>Items 7d:</strong><span id="st-items7">0</span></div></div>
          </div>
          <div class="card" style="margin-top:12px; padding:12px">
            <h3 style="margin:0 0 8px">Ventas por día</h3>
            <canvas id="chart-sales" height="120"></canvas>
          </div>
          <div class="card" style="margin-top:12px; padding:12px">
            <h3 style="margin:0 0 8px">Stock bajo</h3>
            <ul id="low-stock-list" class="spec-list"></ul>
          </div>
        </div>

        <div id="view-products" class="hidden">
          <div class="toolbar">
            <h3>Productos</h3>
            <button id="btn-new" class="btn btn-primary">+ Nuevo producto</button>
          </div>
          <div class="table-scroll"><table class="table" id="tbl-products"><thead><tr><th>ID</th><th>Imagen</th><th>Nombre</th><th>Precio</th><th>Estado</th><th>Stock</th><th>Oferta%</th><th></th></tr></thead><tbody></tbody></table></div>
          <div id="products-pagination" class="pagination" style="margin-top:10px"></div>
          <dialog id="dlg-product">
            <form id="frm-product" style="min-width:640px">
              <h3 id="dlg-title">Producto</h3>
              <div class="grid2">
                <div>
                  <label>Nombre<input id="p-nombre" type="text" required></label>
                  <label>Precio<input id="p-precio" type="number" step="0.01" min="0" max="1000" required></label>
                  <label>Activo<input id="p-activo" type="checkbox"></label>
                  <label>Stock<input id="p-stock" type="number"></label>
                  <label>Oferta %<input id="p-oferta" type="number" min="0" max="90"></label>
                  <label>Desde<input id="p-odesde" type="datetime-local"></label>
                  <label>Hasta<input id="p-ohasta" type="datetime-local"></label>
                </div>
                <div>
                  <label>Descripción<textarea id="p-descripcion" rows="4"></textarea></label>
                  <label>Especificaciones (una por línea)<textarea id="p-espec" rows="4"></textarea></label>
                  <div class="row"><label>Imagen principal</label><input id="p-img-main" type="text" placeholder="img/..." style="flex:1"><input type="file" id="up-main" accept="image/*"></div>
                  <div style="margin-top:8px">
                    <img id="img-main-preview" src="" alt="Previsualización" style="width:100%;height:180px;object-fit:contain;border:1px solid var(--border);border-radius:8px;background:var(--card)" />
                  </div>
                  <div>
                    <div class="row" style="justify-content:space-between"><label>Miniaturas</label><input type="file" id="up-thumbs" accept="image/*" multiple></div>
                    <div id="thumbs" class="thumbs"></div>
                  </div>
                </div>
              </div>
              <menu style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end">
                <button id="btn-cancel" type="button" class="btn btn-secondary">Cancelar</button>
                <button id="btn-save" class="btn btn-primary">Guardar</button>
              </menu>
            </form>
          </dialog>
        </div>

        <div id="view-orders" class="hidden">
          <h3>Pedidos</h3>
          <div class="table-scroll"><table class="table" id="tbl-orders"><thead><tr><th>ID</th><th>UserID</th><th>Nombre</th><th>Estado</th><th>Total</th><th>Creado</th><th>Dirección</th><th></th></tr></thead><tbody></tbody></table></div>
          <dialog id="dlg-order">
            <div style="padding:16px; min-width:600px">
              <h3>Pedido <span id="od-id"></span></h3>
              <div id="od-meta" style="margin-bottom:8px"></div>
              <table class="table"><thead><tr><th>Imagen</th><th>ProductoID</th><th>Título</th><th>Variante</th><th>Precio</th><th>Cantidad</th></tr></thead><tbody id="od-items"></tbody></table>
              <menu style="margin-top:10px; display:flex; gap:8px; justify-content:flex-end">
                <button type="button" class="btn" onclick="document.getElementById('dlg-order').close()">Cerrar</button>
              </menu>
            </div>
          </dialog>
        </div>

        <div id="view-users" class="hidden">
          <h3>Usuarios</h3>
          <div class="table-scroll"><table class="table" id="tbl-users"><thead><tr><th>ID</th><th>Nombre</th><th>Usuario</th><th>Email</th><th>Rol</th><th></th></tr></thead><tbody></tbody></table></div>
        </div>
      </section>
    </div>
  </main>

  <footer class="site-footer">
    <div class="container footer-inner">
      <div><strong>Página3D</strong></div>
      <div class="footer-copy">© 2025 Página3D</div>
    </div>
  </footer>

  <script src="https://cdn.jsdelivr.net/npm/chart.js@4.4.1/dist/chart.umd.min.js"></script>
  <script src="js/site.js?v=20251224" defer></script>
  <script src="js/admin.js?v=20251225" defer></script>
</body>
<html>
